<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YOKU MOKU çµå¸³</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:-apple-system,sans-serif;background:linear-gradient(to bottom,#1e3a5f,#0f172a);min-height:100vh;color:#fff;padding:10px;font-size:14px}
    h1{text-align:center;font-size:1.2rem;margin-bottom:8px}
    .tabs{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:10px}
    .tabs button{padding:6px 10px;border:none;border-radius:6px;background:#374151;color:#9ca3af;font-size:12px;cursor:pointer}
    .tabs button.active{background:#4ade80;color:#000;font-weight:bold}
    .member-section{background:#374151;padding:8px;border-radius:8px;margin-bottom:10px}
    .member-row{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
    .member-row button{padding:5px 10px;border:none;border-radius:5px;font-size:12px;cursor:pointer;background:#1f2937;color:#9ca3af}
    .member-row button.active{background:#f59e0b;color:#000;font-weight:bold}
    .member-row label{font-size:12px;display:flex;align-items:center;gap:4px;color:#fde047}
    .section{margin-bottom:12px}
    .section h2{font-size:13px;margin-bottom:6px;color:#fde047}
    .product-row{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;margin-bottom:5px;background:#1d4ed8}
    .product-row.combo{background:#be185d}
    .product-row.special{background:#7c3aed}
    .product-row.addon{background:#c2410c}
    .product-row.wood{background:#78350f}
    .product-row.cookie{background:#065f46}
    .product-row.cake{background:#be185d}
    .product-row.drink{background:#0369a1}
    .product-row.bag{background:#15803d}
    .product-row .info{flex:1;min-width:0}
    .product-row .name{font-size:12px;color:#e5e7eb}
    .product-row .price{color:#fde047;font-weight:bold;font-size:13px}
    .qty-ctrl{display:flex;align-items:center;gap:3px}
    .qty-ctrl button{width:26px;height:26px;border:none;border-radius:5px;font-size:14px;font-weight:bold;color:#fff;cursor:pointer}
    .qty-ctrl .minus{background:#dc2626}
    .qty-ctrl .plus{background:#16a34a}
    .qty-ctrl input{width:36px;height:26px;text-align:center;border:none;border-radius:4px;font-size:13px}
    .cart{background:#1f2937;border-radius:8px;padding:10px;margin-bottom:10px}
    .cart h3{font-size:14px;margin-bottom:8px;color:#fde047}
    .cart-item{display:flex;justify-content:space-between;align-items:center;padding:4px 6px;margin-bottom:2px;font-size:12px;background:#374151;border-radius:4px}
    .item-name{color:#e5e7eb;flex:1}
    .item-price{display:flex;gap:6px;align-items:center}
    .price-orig{color:#9ca3af;text-decoration:line-through;font-size:11px}
    .price-final{color:#4ade80;font-weight:bold}
    .cat-title{color:#60a5fa;font-size:11px;font-weight:bold;margin:10px 0 4px 0;padding-bottom:2px;border-bottom:1px solid #4b5563}
    .divider{border-top:2px solid #4b5563;margin:10px 0}
    .summary{background:#374151;padding:8px;border-radius:6px;margin-bottom:8px}
    .summary-row{display:flex;justify-content:space-between;padding:3px 0;font-size:13px}
    .summary-row.total{font-size:16px;font-weight:bold;padding-top:6px;border-top:1px solid #4b5563;margin-top:4px}
    .clear-btn{width:100%;background:#dc2626;border:none;color:#fff;padding:10px;border-radius:6px;font-size:14px;font-weight:bold;cursor:pointer;margin-bottom:8px}
    .note{font-size:11px;color:#fdba74;margin-top:4px}
    .discount-info{background:#374151;padding:6px 10px;border-radius:6px;margin-bottom:8px;font-size:11px}
    .loading{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);padding:20px;border-radius:8px;z-index:1000;display:none}
    .loading.show{display:block}
  </style>
</head>
<body>
  <h1>ğŸª YOKU MOKU çµå¸³</h1>
  <div class="loading" id="loading">è¼‰å…¥ä¸­...</div>
  <div id="app">è¼‰å…¥ä¸­...</div>
<script>
// âš™ï¸ è¨­å®šï¼šè«‹å°‡æ­¤ç¶²å€æ”¹ç‚ºæ‚¨çš„ Google Apps Script ç¶²å€
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxbscYaiW6X-3ylDkdeddWyILLfngDRbUS0JHmKU7d2g6VXOhiUmOCuGqJ3o95-GhP1rA/exec';
window.DATA={records:{name:'ğŸ“Šè¨˜éŒ„'},christmas:{name:'ğŸ„è–èª•',box:[{id:'YCG-DXM',name:'åŸå‘³é›ªèŒ„è›‹æ²20å…¥',price:950},{id:'YAN-A',name:'è–„ç‰‡æ¿ƒå·§é›™æ‹¼ç¦®ç›’24å…¥',price:850},{id:'YCN-A',name:'é›ªèŒ„è–„ç‰‡æ¿ƒå·§å¯Œæ‹¼ç¦®ç›’28å…¥',price:1380},{id:'YCN-B',name:'é›ªèŒ„è–„ç‰‡æ¿ƒå·§é›™æ‹¼ç¦®ç›’44å…¥',price:2050},{id:'YHD-A',name:'è‡»é¥Œæ¿ƒå·§ç¦®ç›’30å…¥',price:1500},{id:'YHD-B',name:'å–œé¥Œæ¿ƒå·§ç¦®ç›’50å…¥',price:2100}],bag:[{id:'YCG-AXM',name:'åŸå‘³é›ªèŒ„è›‹æ²10å…¥',price:420},{id:'YBL-AXM',name:'æ¿ƒå·§é›™å±¤å·§å…‹åŠ›è–„ç‰‡é¤…ä¹¾12å…¥',price:420}],combo:[{id:'XMAS-1',name:'è–èª•é›™æ‹¼å–®ç›’',price:1800},{id:'XMAS-2',name:'è–èª•é›™æ‹¼é›™ç›’',price:3500}],special:[{id:'CHOCO18',name:'18å…¥å·§å…‹åŠ›é›ªèŒ„',price:660,orig:1120}],addon:[{id:'CHOCO8',name:'8å…¥å·§å…‹åŠ›é›ªèŒ„(åŠ è³¼)',price:300}]},giftbox:{name:'ğŸç¦®ç›’',general:[{id:'G1',name:'è‡»é¥Œæ¿ƒå·§ç¦®ç›’',price:1280},{id:'G3',name:'å–œé¥Œæ¿ƒå·§ç¦®ç›’',price:1980},{id:'G4',name:'ç››é¥Œæ¿ƒå·§ç¦®ç›’',price:2580},{id:'G6',name:'ç‰¹é¥Œæ¿ƒå·§ç¦®ç›’',price:2980}],double:[{id:'G2',name:'é›ªèŒ„è–„ç‰‡æ¿ƒå·§é›™æ‹¼ç¦®ç›’',price:1880},{id:'G5',name:'é›ªèŒ„è–„ç‰‡æ¿ƒå·§ç‰¹é›™æ‹¼ç¦®ç›’',price:2880}]},cigare:{name:'ğŸ¥šè›‹æ²',items:[{id:'C1',name:'åŸå‘³é›ªèŒ„è›‹æ²10å…¥',price:400},{id:'C2',name:'åŸå‘³é›ªèŒ„è›‹æ²14å…¥',price:620},{id:'YCG-D',name:'åŸå‘³é›ªèŒ„è›‹æ²(20å…¥)',price:920},{id:'YCG-DR',name:'å–œé¥ŒåŸå‘³è›‹æ²(20å…¥)',price:920},{id:'YCG-DJ',name:'ã€å¯Œå£«å±±ã€‘åŸå‘³é›ªèŒ„è›‹æ²(20å…¥)',price:920},{id:'YCG-DTW',name:'ã€å°ç£é™å®šã€‘å¹¸ç¦æˆé›™åŸå‘³é›ªèŒ„è›‹æ²20å…¥',price:920},{id:'C4',name:'åŸå‘³é›ªèŒ„è›‹æ²30å…¥',price:1320},{id:'C5',name:'åŸå‘³é›ªèŒ„è›‹æ²48å…¥',price:2020},{id:'C6',name:'å·§å…‹åŠ›é›ªèŒ„è›‹æ²8å…¥',price:480},{id:'C7',name:'å·§å…‹åŠ›é›ªèŒ„è›‹æ²18å…¥',price:1120}]},autumn:{name:'ğŸ‚ç§‹å†¬è–„ç‰‡',items:[{id:'A1',name:'æ¿ƒå·§é›™å±¤å·§å…‹åŠ›è–„ç‰‡é¤…ä¹¾12å…¥',price:400},{id:'A2',name:'æ¿ƒå·§é›™å±¤å·§å…‹åŠ›é¤…ä¹¾ç¦®ç›’',price:820},{id:'A3',name:'æ¿ƒå·§é›™å±¤æä»è–„ç‰‡é¤…ä¹¾ç¦®ç›’',price:820},{id:'A4',name:'æ¿ƒå·§å¤å¨å¤·è±†å·§å…‹åŠ›é¤…ä¹¾ç¦®ç›’',price:920},{id:'A5',name:'æ¿ƒå·§åœ“æœˆç…é¤…ä¹¾ç¦®ç›’',price:820}]},baton:{name:'ğŸªé¤…ä¹¾æ£’',items:[{id:'B1',name:'ç„™èŒ¶æ‹¿éµé¤…ä¹¾æ£’',price:520},{id:'B2',name:'å¥¶æ²¹é¤…ä¹¾æ£’',price:520}]},wood:{name:'ğŸªµæœ¨ç›’',items:[{id:'W1',name:'æ²ç¦¾ç¦®ç›’-å°',price:580},{id:'W2',name:'æ²ç¦¾ç¦®ç›’-ä¸­',price:880},{id:'W3',name:'æ²ç¦¾ç¦®ç›’-å¤§',price:1580}]},tea:{name:'â˜•ä¸‹åˆèŒ¶',cake:[{id:'T1',name:'å—é’å±±ç”Ÿä¹³æ²',price:220},{id:'T2',name:'è‰è“æµ·ç¶¿è›‹ç³•',price:280},{id:'T3',name:'å·§å…‹åŠ›å¥¶æ²¹è›‹ç³•',price:280},{id:'T4',name:'è’™å¸ƒæœ—è›‹ç³•',price:320},{id:'T5',name:'æŠ¹èŒ¶ææ‹‰ç±³è˜‡',price:320}],drink:[{id:'D1',name:'ç¶“å…¸æ‰‹æ²–å’–å•¡',price:150},{id:'D2',name:'ä¼Šè—¤åœ’èœ‚èœœç´…èŒ¶',price:150},{id:'D3',name:'ä¼Šè—¤åœ’ç‰¹é¸æ—¥å¼ç¶ èŒ¶',price:150}]}};
window.S={cart:{},tab:'christmas',xm:false,m:'normal',bd:false,tv:0,tb:0,td:1,h:[]};

function showLoading(){document.getElementById('loading').classList.add('show')}
function hideLoading(){document.getElementById('loading').classList.remove('show')}

async function loadRecords(){
  if(SCRIPT_URL==='YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'){
    console.log('è«‹å…ˆè¨­å®š Google Apps Script URL');
    return;
  }
  try{
    showLoading();
    const res=await fetch(SCRIPT_URL+'?action=getRecords');
    const data=await res.json();
    window.S.h=data.records||[];
    hideLoading();
    R();
  }catch(e){
    hideLoading();
    console.error('è¼‰å…¥è¨˜éŒ„å¤±æ•—',e);
  }
}

async function saveRecord(record){
  if(SCRIPT_URL==='YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'){
    alert('è«‹å…ˆè¨­å®š Google Apps Script URL');
    return;
  }
  try{
    showLoading();
    await fetch(SCRIPT_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({action:'addRecord',record:record})
    });
    await loadRecords();
    hideLoading();
  }catch(e){
    hideLoading();
    alert('å„²å­˜å¤±æ•—ï¼š'+e.message);
  }
}

async function updateDragon(idx,dragon){
  if(SCRIPT_URL==='YOUR_GOOGLE_APPS_SCRIPT_URL_HERE')return;
  try{
    await fetch(SCRIPT_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({action:'updateDragon',index:idx,dragon:dragon})
    });
  }catch(e){
    console.error('æ›´æ–°å¤±æ•—',e);
  }
}

async function deleteRecord(idx){
  if(!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„ï¼Ÿ'))return;
  if(SCRIPT_URL==='YOUR_GOOGLE_APPS_SCRIPT_URL_HERE')return;
  try{
    showLoading();
    await fetch(SCRIPT_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({action:'deleteRecord',index:idx})
    });
    await loadRecords();
    hideLoading();
  }catch(e){
    hideLoading();
    alert('åˆªé™¤å¤±æ•—ï¼š'+e.message);
  }
}

function toggleDragon(idx){
  window.S.h[idx].dragon=!window.S.h[idx].dragon;
  updateDragon(idx,window.S.h[idx].dragon);
  R();
}

function Q(i){return window.S.cart[i]||0}
function SQ(i,v){v=Math.max(0,parseInt(v)||0);v>0?window.S.cart[i]=v:delete window.S.cart[i];R()}
function A(i,d){SQ(i,Q(i)+d)}
function getDis(){const s=window.S;if(s.m==='blue')return s.bd?0.9:0.95;if(s.m==='white')return s.bd?0.9:1;return 1}
function getBoxDis(){const s=window.S;const d=window.DATA.christmas;let bq=0;d.box.forEach(p=>bq+=Q(p.id));if(bq>=101)return 0.85;if(bq>=50)return 0.86;if(bq>=2)return(s.xm||s.m!=='normal')?0.89:0.95;return 1}

function CO(items,total,orig){
  if(total===0){alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼');return}
  const ts=new Date().toLocaleString('zh-TW');
  const record={time:ts,items:items,total:total};
  saveRecord(record);
  alert('âœ…çµå¸³æˆåŠŸï¼\næ™‚é–“ï¼š'+ts+'\nåŸåƒ¹ï¼š$'+orig.toLocaleString()+'\nå¯¦ä»˜ï¼š$'+total.toLocaleString()+'\nçœäº†ï¼š$'+(orig-total).toLocaleString());
  window.S.cart={};
  window.S.tv=0;
  window.S.tb=0;
  window.S.td=1;
  window.S.xm=false;
  window.S.m='normal';
  window.S.bd=false;
  window.S.tab='records';
}

function R(){const s=window.S,d=window.DATA;const Q2=(i,dis)=>'<div class="qty-ctrl"><button class="minus" onclick="A(\''+i+'\',-1)">-</button><input type="number" value="'+Q(i)+'" onchange="SQ(\''+i+'\',this.value)"><button class="plus" onclick="A(\''+i+'\',1)"'+(dis?' style="background:#666"':'')+'>+</button></div>';let h='<div class="tabs">'+Object.keys(d).map(k=>'<button class="'+(s.tab===k?'active':'')+'" onclick="window.S.tab=\''+k+'\';R()">'+d[k].name+'</button>').join('')+'</div>';if(s.tab==='records'){const td=new Date().toLocaleDateString('zh-TW');const tt=s.h.reduce((sum,r)=>sum+r.total,0);const tto=s.h.reduce((sum,r)=>sum+(r.original||r.total),0);const tts=tto-tt;h+='<div class="discount-info">ğŸ“…'+td+' | å…±'+s.h.length+'ç­† | ç‡Ÿæ¥­é¡$'+tt.toLocaleString()+(tts>0?' | çœ$'+tts.toLocaleString():'')+'</div><div style="background:#1f2937;border-radius:8px;padding:10px;margin-bottom:10px;max-height:70vh;overflow-y:auto">';if(s.h.length===0)h+='<div style="color:#666;text-align:center;padding:20px">ä»Šå¤©é‚„æ²’æœ‰çµå¸³è¨˜éŒ„</div>';else{s.h.forEach((r,i)=>{const n=i+1;const sv=r.saved||0;h+='<div style="background:#374151;border-radius:6px;padding:10px;margin-bottom:8px"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><div style="display:flex;align-items:center;gap:8px"><b style="color:#fde047">#'+n+' '+r.time.split(' ')[1]+'</b><label style="display:flex;align-items:center;gap:4px;font-size:11px;color:#fde047;cursor:pointer"><input type="checkbox"'+(r.dragon?' checked':'')+' onchange="toggleDragon('+i+')" style="cursor:pointer">ç¥¥é¾</label></div><div style="display:flex;align-items:center;gap:8px"><div style="text-align:right"><b style="color:#4ade80;font-size:1.1rem">$'+r.total.toLocaleString()+'</b>'+(sv>0?'<div style="color:#fbbf24;font-size:10px">çœ$'+sv.toLocaleString()+'</div>':'')+'</div><button onclick="deleteRecord('+i+')" style="background:#dc2626;border:none;color:#fff;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:16px">ğŸ—‘ï¸</button></div></div><div style="font-size:11px;color:#9ca3af">';r.items.forEach(it=>h+='<div style="margin:2px 0">â€¢ '+it+'</div>');h+='</div></div>'})}h+='</div>'}else if(s.tab==='christmas'){const dd=d.christmas;h+='<div class="member-section"><div class="member-row"><button class="'+(!s.xm&&s.m==='normal'?'active':'')+'" onclick="window.S.xm=false;window.S.m=\'normal\';R()">ä¸€èˆ¬</button><button class="'+(s.xm||s.m!=='normal'?'active':'')+'" onclick="window.S.xm=true;R()">ğŸ‘‘æœƒå“¡</button></div></div><div class="discount-info">ğŸ“¦ç›’è£:2ç›’'+(s.xm||s.m!=='normal'?'89':'95')+'æŠ˜/50ç›’86æŠ˜/101ç›’85æŠ˜ | ğŸè¢‹è£:3è¢‹ä»¥ä¸Šæ¯è¢‹$400</div><div class="section"><h2>è–èª•é›™æ‹¼</h2>'+dd.combo.map(p=>'<div class="product-row combo"><div class="info"><div class="name">'+p.name+'</div><div class="price">$'+p.price.toLocaleString()+'</div></div>'+Q2(p.id)+'</div>').join('')+'</div><div class="section"><h2>å·§å…‹åŠ›ç‰¹æƒ </h2>'+dd.special.map(p=>'<div class="product-row special"><div class="info"><div class="name">'+p.name+'</div><div class="price"><s style="color:#999">$'+p.orig.toLocaleString()+'</s> â†’ $'+p.price.toLocaleString()+'</div></div>'+Q2(p.id)+'</div>').join('')+'</div><div class="section"><h2>ç›’è£</h2>'+dd.box.map(p=>'<div class="product-row"><div class="info"><div class="name">'+p.name+'</div><div class="price">$'+p.price.toLocaleString()+'</div></div>'+Q2(p.id)+'</div>').join('')+'</div><div class="section"><h2>è¢‹è£</h2>'+dd.bag.map(p=>'<div class="product-row bag"><div class="info"><div class="name">'+p.name+'</div><div class="price">$'+p.price.toLocaleString()+'</div></div>'+Q2(p.id)+'</div>').join('')+'</div><div class="section"><h2>åŠ è³¼</h2>'+dd.addon.map(p=>'<div class="product-row addon"><div class="info"><div class="name">'+p.name+'</div><div class="price">+$'+p.price.toLocaleString()+'</div></div>'+Q2(p.id,!(d.christmas.box.some(x=>Q(x.id)>0)||d.christmas.bag.some(x=>Q(x.id)>0)||d.christmas.combo.some(x=>Q(x.id)>0)))+'</div>').join('')+'<div class="note">â€»éœ€å…ˆé¸è³¼è–èª•å•†å“æ‰èƒ½åŠ è³¼</div></div>'}else if(s.tab==='giftbox'){const gg=d.giftbox;h+='<div class="member-section"><div class="member-row"><button class="'+(s.m==='normal'?'active':'')+'" onclick="window.S.m=\'normal\';R()">ä¸€èˆ¬</button><button class="'+(s.m==='blue'?'active':'')+'" onclick="window.S.m=\'blue\';R()">ğŸ’è—é‘½</button><button class="'+(s.m==='white'?'active':'')+'" onclick="window.S.m=\'white\';R()">â¬œç™½é‘½</button><label><input type="checkbox"'+(s.bd?' checked':'')+' onchange="window.S.bd=this.checked;R()">ç”Ÿæ—¥æœˆ</label></div></div><div class="discount-info">'+(s.m==='blue'?'ğŸ’è—é‘½:'+(s.bd?'ç”Ÿæ—¥æœˆ9æŠ˜':'95æŠ˜'):s.m==='white'?'â¬œç™½é‘½:'+(s.bd?'ç”Ÿæ—¥æœˆ9æŠ˜':'åŸåƒ¹'):'ä¸€èˆ¬:åŸåƒ¹')+'</div><div class="section"><h2>ğŸä¸€èˆ¬ç¦®ç›’</h2>'+gg.general.map(p=>'<div class="product-row"><div class="info"><div class="name">'+p.name+'</div><div class="price">$'+p.price.toLocaleString()+'</div></div>'+Q2(p.id)+'</div>').join('')+'</div><div class="section"><h2>ğŸ€é›™æ‹¼ç¦®ç›’</h2>'+gg.double.map(p=>'<div class="product-row"><div class="info"><div class="name">'+p.name+'</div><div class="price">$'+p.price.toLocaleString()+'</div></div>'+Q2(p.id)+'</div>').join('')+'</div>'}else if(s.tab==='tea'){const tt=d.tea;h+='<div class="discount-info">â˜•1è›‹ç³•+1é£²æ–™=1å¥—,é£²æ–™-$30</div><div style="background:#374151;padding:8px;border-radius:6px;margin-bottom:8px;font-size:12px"><b style="display:block;margin-bottom:6px">æ•´å–®æŠ˜æ‰£:</b><div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px">'+[1,0.95,0.9,0.85,0.7].map(v=>'<button style="padding:4px 12px;border:none;border-radius:4px;cursor:pointer;'+(s.td===v?'background:#f59e0b;color:#000;font-weight:bold':'background:#1f2937;color:#9ca3af')+'" onclick="window.S.td='+v+';R()">'+(v===1?'ç„¡':Math.round(v*100)+'æŠ˜')+'</button>').join('')+'</div><label>ğŸ‘‘è²´è³“åˆ¸:<input type="number" value="'+s.tv+'" min="0" style="width:40px" onchange="window.S.tv=Math.max(0,+this.value);R()">å¥—</label><br><label style="margin-top:4px">ğŸ‚ç”Ÿæ—¥ç¦®:<input type="number" value="'+s.tb+'" min="0" style="width:40px" onchange="window.S.tb=Math.max(0,+this.value);R()">å¥—</label></div><div class="section"><h2>è›‹ç³•</h2>'+tt.cake.map(p=>'<div class="product-row cake"><div class="info"><div class="name">'+p.name+'</div><div class="price">$'+p.price.toLocaleString()+'</div></div>'+Q2(p.id)+'</div>').join('')+'</div><div class="section"><h2>é£²å“</h2>'+tt.drink.map(p=>'<div class="product-row drink"><div class="info"><div class="name">'+p.name+'</div><div class="price">$'+p.price.toLocaleString()+'</div></div>'+Q2(p.id)+'</div>').join('')+'</div>'}else{const cc=d[s.tab];const st=s.tab==='wood'?'wood':s.tab==='baton'?'cookie':'';h+='<div class="member-section"><div class="member-row"><button class="'+(s.m==='normal'?'active':'')+'" onclick="window.S.m=\'normal\';R()">ä¸€èˆ¬</button><button class="'+(s.m==='blue'?'active':'')+'" onclick="window.S.m=\'blue\';R()">ğŸ’è—é‘½</button><button class="'+(s.m==='white'?'active':'')+'" onclick="window.S.m=\'white\';R()">â¬œç™½é‘½</button><label><input type="checkbox"'+(s.bd?' checked':'')+' onchange="window.S.bd=this.checked;R()">ç”Ÿæ—¥æœˆ</label></div></div><div class="discount-info">'+(s.m==='blue'?'ğŸ’è—é‘½:'+(s.bd?'ç”Ÿæ—¥æœˆ9æŠ˜':'95æŠ˜'):s.m==='white'?'â¬œç™½é‘½:'+(s.bd?'ç”Ÿæ—¥æœˆ9æŠ˜':'åŸåƒ¹'):'ä¸€èˆ¬:åŸåƒ¹')+'</div><div class="section"><h2>'+cc.name+'</h2>'+cc.items.map(p=>'<div class="product-row '+st+'"><div class="info"><div class="name">'+p.name+'</div><div class="price">$'+p.price.toLocaleString()+'</div></div>'+Q2(p.id)+'</div>').join('')+'</div>'}let gt=0,got=0;const items=[];h+='<div class="cart"><h3>ğŸ›’ è³¼ç‰©è»Š</h3>';const boxDis=getBoxDis();const genDis=getDis();let hasXmas=false;if(d.christmas.combo.some(p=>Q(p.id)>0)){h+='<div class="cat-title">è–èª•é›™æ‹¼</div>';d.christmas.combo.forEach(p=>{const q=Q(p.id);if(q>0){const t=p.price*q;h+='<div class="cart-item"><span class="item-name">'+p.name+' x'+q+'</span><span class="price-final">$'+t.toLocaleString()+'</span></div>';gt+=t;got+=t;items.push(p.name+' x'+q+' $'+t.toLocaleString());hasXmas=true}})}if(Q('CHOCO18')>0){const p=d.christmas.special[0];const q=Q('CHOCO18');const o=p.orig*q;const f=p.price*q;h+='<div class="cat-title">å·§å…‹åŠ›ç‰¹æƒ </div><div class="cart-item"><span class="item-name">'+p.name+' x'+q+'</span><div class="item-price"><span class="price-orig">$'+o.toLocaleString()+'</span><span class="price-final">$'+f.toLocaleString()+'</span></div></div>';gt+=f;got+=o;items.push(p.name+' x'+q+' åŸ$'+o.toLocaleString()+'â†’$'+f.toLocaleString());hasXmas=true}let boxCnt=0,boxOrig=0;d.christmas.box.forEach(p=>{const q=Q(p.id);if(q>0){boxCnt+=q;boxOrig+=p.price*q}});if(boxCnt>0){const boxFinal=Math.round(boxOrig*boxDis);h+='<div class="cat-title">è–èª•ç›’è£'+(boxDis<1?' ('+Math.round(boxDis*100)+'æŠ˜)':'')+'</div>';d.christmas.box.forEach(p=>{const q=Q(p.id);if(q>0){const o=p.price*q;const f=Math.round(o*boxDis);h+='<div class="cart-item"><span class="item-name">'+p.name+' x'+q+'</span><div class="item-price">'+(boxDis<1?'<span class="price-orig">$'+o.toLocaleString()+'</span>':'')+'<span class="price-final">$'+f.toLocaleString()+'</span></div></div>';items.push(p.name+' x'+q+(boxDis<1?' åŸ$'+o.toLocaleString()+'â†’$'+f.toLocaleString():' $'+f.toLocaleString()))}});gt+=boxFinal;got+=boxOrig;hasXmas=true}let bagCnt=0,bagOrig=0;d.christmas.bag.forEach(p=>{const q=Q(p.id);if(q>0){bagCnt+=q;bagOrig+=p.price*q}});if(bagCnt>0){const bagFinal=bagCnt>=3?bagCnt*400:bagOrig;h+='<div class="cat-title">è–èª•è¢‹è£'+(bagCnt>=3?' (æ¯è¢‹$400)':'')+'</div>';d.christmas.bag.forEach(p=>{const q=Q(p.id);if(q>0){const o=p.price*q;const f=bagCnt>=3?400*q:o;h+='<div class="cart-item"><span class="item-name">'+p.name+' x'+q+'</span><div class="item-price">'+(f<o?'<span class="price-orig">$'+o.toLocaleString()+'</span>':'')+'<span class="price-final">$'+f.toLocaleString()+'</span></div></div>';items.push(p.name+' x'+q+(f<o?' åŸ$'+o.toLocaleString()+'â†’$'+f.toLocaleString():' $'+f.toLocaleString()))}});gt+=bagFinal;got+=bagOrig;hasXmas=true}if(Q('CHOCO8')>0&&hasXmas){const q=Q('CHOCO8');const t=300*q;h+='<div class="cat-title">åŠ è³¼</div><div class="cart-item"><span class="item-name">8å…¥å·§å…‹åŠ›é›ªèŒ„ x'+q+'</span><span class="price-final">$'+t.toLocaleString()+'</span></div>';gt+=t;got+=t;items.push('8å…¥å·§å…‹åŠ›é›ªèŒ„(åŠ è³¼) x'+q+' $'+t.toLocaleString())}[{k:'giftbox',i:[...d.giftbox.general,...d.giftbox.double],n:'ç¦®ç›’'},{k:'cigare',i:d.cigare.items,n:d.cigare.name},{k:'autumn',i:d.autumn.items,n:d.autumn.name},{k:'baton',i:d.baton.items,n:d.baton.name},{k:'wood',i:d.wood.items,n:d.wood.name}].forEach(c=>{let co=0,cf=0;const ci=[];c.i.forEach(p=>{const q=Q(p.id);if(q>0){const o=p.price*q;const f=Math.round(o*genDis);co+=o;cf+=f;ci.push({p:p,q:q,o:o,f:f})}});if(ci.length>0){h+='<div class="cat-title">'+c.n+(genDis<1?' ('+Math.round(genDis*100)+'æŠ˜)':'')+'</div>';ci.forEach(it=>{h+='<div class="cart-item"><span class="item-name">'+it.p.name+' x'+it.q+'</span><div class="item-price">'+(genDis<1?'<span class="price-orig">$'+it.o.toLocaleString()+'</span>':'')+'<span class="price-final">$'+it.f.toLocaleString()+'</span></div></div>';items.push(it.p.name+' x'+it.q+(genDis<1?' åŸ$'+it.o.toLocaleString()+'â†’$'+it.f.toLocaleString():' $'+it.f.toLocaleString()))});gt+=cf;got+=co}});let cq=0,ct=0,dq=0,dt=0;d.tea.cake.forEach(p=>{const q=Q(p.id);if(q>0){cq+=q;ct+=p.price*q}});d.tea.drink.forEach(p=>{const q=Q(p.id);if(q>0){dq+=q;dt+=p.price*q}});if(cq>0||dq>0){const sets=Math.min(cq,dq);const free=Math.min(sets,s.tv+s.tb);const paid=Math.max(0,sets-free);const ac=cq>0?ct/cq:0;const ad=dq>0?dt/dq:150;const base=ac+ad;const paidT=paid*(base-30)*s.td;const extraC=Math.max(0,cq-sets);const extraD=Math.max(0,dq-sets);const extraT=(extraC*ac+extraD*ad)*s.td;const tf=Math.round(paidT+extraT);const to=ct+dt;const freeV=Math.round(free*base);h+='<div class="cat-title">ä¸‹åˆèŒ¶ ('+sets+'å¥—'+(free>0?' å«å…è²»'+free+'å¥—':'')+(s.td<1?' '+Math.round(s.td*100)+'æŠ˜':'')+')</div>';d.tea.cake.forEach(p=>{const q=Q(p.id);if(q>0)h+='<div class="cart-item"><span class="item-name">'+p.name+' x'+q+'</span><span class="price-final">$'+(p.price*q).toLocaleString()+'</span></div>'});d.tea.drink.forEach(p=>{const q=Q(p.id);if(q>0)h+='<div class="cart-item"><span class="item-name">'+p.name+' x'+q+'</span><span class="price-final">$'+(p.price*q).toLocaleString()+'</span></div>'});if(free>0||s.td<1){h+='<div class="cart-item" style="background:#065f46"><span class="item-name">å¥—é¤å„ªæƒ '+(free>0?' (å…è²»'+free+'å¥— -$'+freeV.toLocaleString()+')':'')+(s.td<1?' ('+Math.round(s.td*100)+'æŠ˜)':'')+'</span></div>'}items.push('ä¸‹åˆèŒ¶'+sets+'å¥—'+(free>0?' å«å…è²»'+free+'å¥—':'')+' åŸ$'+to.toLocaleString()+'â†’$'+tf.toLocaleString());gt+=tf;got+=to}if(gt===0)h+='<div style="color:#666;text-align:center;padding:20px;font-size:12px">è³¼ç‰©è»Šæ˜¯ç©ºçš„</div>';const save=got-gt;h+='<div class="divider"></div><div class="summary">'+(save>0?'<div class="summary-row"><span>åŸåƒ¹:</span><span style="color:#9ca3af">$'+got.toLocaleString()+'</span></div><div class="summary-row"><span>æŠ˜æ‰£:</span><span style="color:#f87171">-$'+save.toLocaleString()+'</span></div>':'')+'<div class="summary-row total"><span>æ‡‰ä»˜é‡‘é¡</span><span style="color:#4ade80">$'+gt.toLocaleString()+'</span></div></div></div>';h+='<button class="clear-btn" style="background:#16a34a" onclick="CO('+JSON.stringify(items).replace(/"/g,"&quot;")+','+gt+','+got+')">ğŸ’°çµå¸³ $'+gt.toLocaleString()+(save>0?' (çœ$'+save.toLocaleString()+')':'')+'</button>';h+='<button class="clear-btn" onclick="window.S.cart={};window.S.tv=0;window.S.tb=0;window.S.td=1;window.S.xm=false;window.S.m=\'normal\';window.S.bd=false;R()">ğŸ—‘ï¸æ¸…ç©ºè³¼ç‰©è»Š</button>';document.getElementById('app').innerHTML=h}

loadRecords();
R();
</script>
</body>
</html>



